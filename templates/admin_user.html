<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Users | Admin | PaySafe AI</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style_main.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style_user.css') }}"
    />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='Asset/favicon_io/apple-touch-icon.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='Asset/favicon_io/favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='Asset/favicon_io/favicon-16x16.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='Asset/favicon_io/site.webmanifest') }}"
    />
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">PaySafe AI</div>
        <ul class="nav-links">
          <li><a href="{{ url_for('index_admin') }}">Home</a></li>
          <li>
            <a href="{{ url_for('admin_user') }}" class="active">Users</a>
          </li>
          <li><a href="{{ url_for('admin_dashboard') }} ">Dashboard</a></li>
          <li><a href="{{ url_for('index') }}">Logout</a></li>
        </ul>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-content">
        <h1>User Management</h1>
        <p>
          View registered users, manage access, and perform administrative
          actions.
        </p>
      </div>
    </section>

    <section class="features">
      <h2>Registered Users</h2>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersTableBody"></tbody>
        </table>
      </div>
    </section>

    <script>
      async function fetchUsers() {
        try {
          const res = await fetch("/api/admin/users");
          const users = await res.json();

          const tbody = document.getElementById("usersTableBody");
          tbody.innerHTML = "";

          users.forEach((user) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td><button onclick="deleteUser('${user._id}')">Delete</button></td>
        `;
            tbody.appendChild(tr);
          });
        } catch (err) {
          console.error("Error fetching users:", err);
        }
      }

      async function deleteUser(id) {
        if (!confirm("Are you sure you want to delete this user?")) return;

        try {
          await fetch(`/api/admin/users/${id}`, {
            method: "DELETE",
          });
          fetchUsers();
        } catch (err) {
          console.error("Error deleting user:", err);
        }
      }
      fetchUsers();
    </script>
  </body>
</html>
